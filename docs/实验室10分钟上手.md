# Squidiff LabFlow V2：实验室 10 分钟上手

> 目标：让实验室成员在 10 分钟内完成一次 Seurat 数据上传、500x500 预处理与训练提交。

## 0. 开始前准备（约 2 分钟）

- 你需要一个可用的数据文件：`.h5ad`、`.rds` 或 `.h5seurat`
- 如果是 Seurat 文件，建议包含：
  - 分组字段（例如 `sample`）
  - 类群字段（例如 `celltype`）
  - UMAP（可选但推荐）

## 1. 上传与校验（约 2 分钟）

1. 打开前端页面，上传主数据文件。  
2. 点击“开始校验”。  
3. 确认校验通过，且能看到 `cells/genes`。  

若是 `.rds/.h5seurat`，系统会先转换为 `h5ad` 再校验。

## 2. Seurat 解析（约 1 分钟）

1. 点击“解析 Seurat”。  
2. 确认页面显示：
   - metadata 字段列表
   - UMAP 预览（若无 UMAP，会提示但不阻断流程）

## 3. 500x500 预处理（约 2 分钟）

1. 填写：
   - `group_column`（例如 `sample`）
   - `cluster_column`（例如 `celltype`）
   - `selected_clusters`（例如 `T,B,NK`）
2. 点击“准备训练数据（500x500）”。
3. 确认结果：
   - `prepared_dataset_id` 已生成
   - `n_cells <= 500`
   - `n_genes <= 500`

## 4. 提交训练（约 2 分钟）

1. 点击“开始训练”。  
2. 默认会使用 `prepared_dataset_id` 作为训练输入。  
3. 在任务状态区确认：
   - `source_dataset_id`
   - `train_dataset_id`
   - `prepared_dataset_id`

## 5. 查看结果（约 1 分钟）

训练成功后，在结果区查看：
- model 信息（checkpoint、gene_size、output_dim）
- 可视化资产（图像）
- 日志（可展开）

---

## 常见失败与处理

- `Dataset has no prepared h5ad path`  
  - 先执行“开始校验”。
- `group_column not found` / `cluster_column not found`  
  - 检查字段名拼写是否与 metadata 一致。
- `No cells left after cluster filtering`  
  - 放宽 `selected_clusters`，或检查类群字段内容。
- 训练失败但预处理成功  
  - 优先检查训练日志与依赖环境（模型脚本、GPU/CPU资源、路径权限）。

---

## 相关文档

- 转换指南：`docs/seurat转换指南.md`
- Seurat API：`docs/api/seurat.md`
- V2 PRD：`docs/PRD_Seurat交互筛选与500x500训练管线.md`
